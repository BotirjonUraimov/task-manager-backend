<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Task Backend API - Documentation</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        line-height: 1.6;
        color: #333;
        background: #f8f9fa;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px 0;
        text-align: center;
        margin-bottom: 30px;
        border-radius: 10px;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .quick-links {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .quick-link {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        text-decoration: none;
        color: inherit;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .quick-link:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      }

      .quick-link h3 {
        color: #667eea;
        margin-bottom: 10px;
      }

      .section {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .section h2 {
        color: #333;
        border-bottom: 2px solid #667eea;
        padding-bottom: 10px;
        margin-bottom: 20px;
      }

      .code-block {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        padding: 15px;
        margin: 15px 0;
        overflow-x: auto;
        font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
        font-size: 0.9rem;
      }

      .endpoint {
        background: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 15px;
        margin: 15px 0;
        border-radius: 0 6px 6px 0;
      }

      .endpoint .method {
        font-weight: bold;
        color: #1976d2;
      }

      .endpoint .path {
        font-family: monospace;
        background: #fff;
        padding: 2px 6px;
        border-radius: 4px;
      }

      .endpoint .description {
        margin-top: 8px;
        color: #555;
      }

      .tech-stack {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .tech-item {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        text-align: center;
        border: 1px solid #e9ecef;
      }

      .tech-item strong {
        color: #667eea;
      }

      .copy-btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.8rem;
        margin-left: 10px;
      }

      .copy-btn:hover {
        background: #5a6fd8;
      }

      .copy-btn.copied {
        background: #28a745;
      }

      .status {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: bold;
      }

      .status.online {
        background: #d4edda;
        color: #155724;
      }

      .status.offline {
        background: #f8d7da;
        color: #721c24;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üöÄ Task Backend API</h1>
        <p>
          Node.js, Express, TypeScript, Mongoose - Production Ready REST API
        </p>
      </div>

      <div class="quick-links">
        <a href="/docs" class="quick-link">
          <h3>üìö Swagger Docs</h3>
          <p>Interactive API documentation and testing</p>
        </a>
        <a href="/api" class="quick-link">
          <h3>üîó API Base</h3>
          <p>All API endpoints under /api prefix</p>
        </a>
        <a
          href="https://github.com/BotirjonUraimov/task-manager-backend"
          class="quick-link"
        >
          <h3>üìñ GitHub</h3>
          <p>Source code and full documentation</p>
        </a>
      </div>

      <div class="section">
        <h2>üöÄ Quick Start</h2>
        <p><strong>Prerequisites:</strong> Node.js 18+, MongoDB</p>

        <h3>Installation</h3>
        <div class="code-block">
          git clone https://github.com/BotirjonUraimov/task-manager-backend.git
          cd backend npm install
        </div>

        <h3>Environment Setup</h3>
        <p>Create a <code>.env</code> file:</p>
        <div class="code-block">
          PORT=3000 MONGODB_URI=mongodb://localhost:27017/mohirdev_tasks
          JWT_SECRET=change-me-in-prod JWT_EXPIRES_IN=1h
        </div>

        <h3>Run Commands</h3>
        <div class="code-block">
          # Development npm run dev # Production npm run build npm start
        </div>
      </div>

      <div class="section">
        <h2>üõ†Ô∏è Tech Stack</h2>
        <div class="tech-stack">
          <div class="tech-item">
            <strong>Node.js</strong><br />
            + TypeScript
          </div>
          <div class="tech-item">
            <strong>Express 5</strong><br />
            Web framework
          </div>
          <div class="tech-item">
            <strong>Mongoose 8</strong><br />
            MongoDB ODM
          </div>
          <div class="tech-item">
            <strong>JWT</strong><br />
            Authentication
          </div>
          <div class="tech-item">
            <strong>Zod</strong><br />
            Validation
          </div>
          <div class="tech-item">
            <strong>Pino</strong><br />
            Logging
          </div>
        </div>
      </div>

      <div class="section">
        <h2>üîê Authentication</h2>
        <p>
          All protected endpoints require JWT token in Authorization header:
        </p>
        <div class="code-block">Authorization: &lt;your-jwt-token&gt;</div>

        <h3>Get Token</h3>
        <div class="endpoint">
          <div class="method">POST</div>
          <div class="path">/api/auth/login</div>
          <div class="description">
            Login with email/password to get access token
          </div>
        </div>
      </div>

      <div class="section">
        <h2>üìã Complete API Reference</h2>

        <h3>üîê Authentication</h3>
        <p>
          <strong
            >All protected endpoints require JWT token in Authorization
            header:</strong
          >
        </p>
        <div class="code-block">Authorization: &lt;your-jwt-token&gt;</div>

        <h4>POST /api/auth/register</h4>
        <div class="endpoint">
          <div class="method">POST</div>
          <div class="path">/api/auth/register</div>
          <div class="description">Create new user account (public)</div>
        </div>
        <p><strong>Request Body:</strong></p>
        <div class="code-block">
          { "name": "Botirjon", "email": "botirjon@mail.com", "password":
          "secret123", "role": "user" // optional, defaults to "user" }
        </div>
        <p><strong>Response:</strong></p>
        <div class="code-block">
          { "id": "689d8f559ad355020b526bc5", "name": "Botirjon", "email":
          "botirjon@mail.com", "role": "user" }
        </div>

        <h4>POST /api/auth/login</h4>
        <div class="endpoint">
          <div class="method">POST</div>
          <div class="path">/api/auth/login</div>
          <div class="description">Login and get JWT token (public)</div>
        </div>
        <p><strong>Request Body:</strong></p>
        <div class="code-block">
          { "email": "botirjon@mail.com", "password": "secret123" }
        </div>
        <p><strong>Response:</strong></p>
        <div class="code-block">
          { "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." }
        </div>

        <h4>GET /api/auth/me</h4>
        <div class="endpoint">
          <div class="method">GET</div>
          <div class="path">/api/auth/me</div>
          <div class="description">Get current user info (protected)</div>
        </div>
        <p><strong>Response:</strong></p>
        <div class="code-block">
          { "id": "689d8f559ad355020b526bc5", "name": "Botirjon", "email":
          "botirjon@mail.com", "role": "user" }
        </div>

        <h3>üìã Tasks Management</h3>

        <h4>GET /api/tasks</h4>
        <div class="endpoint">
          <div class="method">GET</div>
          <div class="path">/api/tasks</div>
          <div class="description">List tasks (admin: all, user: own)</div>
        </div>
        <p><strong>Query Parameters:</strong></p>
        <div class="code-block">
          ?page=1&limit=10&sortBy=createdAt&sortOrder=desc
        </div>
        <p><strong>Response:</strong></p>
        <div class="code-block">
          { "data": [ { "id": "689dee48778c9f73567536ae", "title": "Write
          documentation", "description": "Create comprehensive API docs",
          "dueDate": "2025-12-31T00:00:00.000Z", "priority": "high", "status":
          "pending", "tags": ["docs", "api"], "assignedTo":
          "689d8f559ad355020b526bc5", "assignedBy": "689d8f559ad355020b526bc5",
          "startedAt": null, "completedAt": null, "cancelledAt": null,
          "createdBy": "689d8f559ad355020b526bc5", "history": [], "createdAt":
          "2025-08-14T14:10:16.959Z", "updatedAt": "2025-08-14T14:10:16.959Z" }
          ], "total": 1, "page": 1, "limit": 10 }
        </div>

        <h4>GET /api/tasks/assigned</h4>
        <div class="endpoint">
          <div class="method">GET</div>
          <div class="path">/api/tasks/assigned</div>
          <div class="description">
            List tasks assigned to current user (user only)
          </div>
        </div>
        <p><strong>Query Parameters:</strong> Same as /api/tasks</p>
        <p><strong>Response:</strong> Same structure as /api/tasks</p>

        <h4>GET /api/tasks/:id</h4>
        <div class="endpoint">
          <div class="method">GET</div>
          <div class="path">/api/tasks/:id</div>
          <div class="description">
            Get specific task (admin: any, user: own or assigned)
          </div>
        </div>
        <p>
          <strong>Response:</strong> Single task object (same structure as
          above)
        </p>

        <h4>POST /api/tasks</h4>
        <div class="endpoint">
          <div class="method">POST</div>
          <div class="path">/api/tasks</div>
          <div class="description">Create new task (protected)</div>
        </div>
        <p><strong>Request Body:</strong></p>
        <div class="code-block">
          { "title": "New Task", "description": "Task description", "dueDate":
          "2025-12-31", "priority": "medium", // "low", "medium", "high"
          "status": "pending", // "pending", "in_progress", "completed",
          "cancelled" "assignedTo": "689d8f559ad355020b526bc5", // optional
          "tags": ["work", "urgent"] // optional }
        </div>
        <p>
          <strong>Note:</strong> If assignedTo is set, assignedBy will
          automatically be set to the current user
        </p>

        <h4>PUT /api/tasks/:id</h4>
        <div class="endpoint">
          <div class="method">PUT</div>
          <div class="path">/api/tasks/:id</div>
          <div class="description">
            Update task (admin: any, user: own or assigned)
          </div>
        </div>
        <p><strong>Request Body:</strong> Any combination of task fields</p>
        <div class="code-block">
          { "title": "Updated Task Title", "status": "in_progress", "priority":
          "high" }
        </div>
        <p><strong>Special Behavior:</strong></p>
        <ul style="margin-left: 20px; margin-top: 10px">
          <li>
            <strong>Status Changes:</strong> Automatically sets timestamps:
            <ul style="margin-left: 20px; margin-top: 5px">
              <li><code>in_progress</code> ‚Üí sets <code>startedAt</code></li>
              <li><code>completed</code> ‚Üí sets <code>completedAt</code></li>
              <li><code>cancelled</code> ‚Üí sets <code>cancelledAt</code></li>
            </ul>
          </li>
          <li>
            <strong>History Tracking:</strong> Automatically logs status changes
          </li>
          <li>
            <strong>Assignment:</strong> Non-admin users cannot change
            <code>assignedTo</code>
          </li>
        </ul>

        <h4>DELETE /api/tasks/:id</h4>
        <div class="endpoint">
          <div class="method">DELETE</div>
          <div class="path">/api/tasks/:id</div>
          <div class="description">
            Delete task (admin: any, user: own only)
          </div>
        </div>
        <p><strong>Response:</strong> 204 No Content</p>

        <h3>üìä Analytics (Admin Only)</h3>

        <h4>GET /api/tasks/analytics</h4>
        <div class="endpoint">
          <div class="method">GET</div>
          <div class="path">/api/tasks/analytics</div>
          <div class="description">
            Comprehensive task statistics and insights
          </div>
        </div>
        <p><strong>Query Parameters (all optional):</strong></p>
        <div class="code-block">
          ?from=2025-01-01&to=2025-12-31&assignedTo=userId&createdBy=userId&status=pending&tags=work,urgent
        </div>
        <p><strong>Response:</strong></p>
        <div class="code-block">
          { "statusBreakdown": [ { "status": "pending", "count": 5 }, {
          "status": "in_progress", "count": 3 }, { "status": "completed",
          "count": 12 }, { "status": "cancelled", "count": 1 } ], "overdue": 2,
          "upcoming": 4, "perUserCounts": [ { "assignedTo":
          "689d8f559ad355020b526bc5", "count": 8, "userName": "Botirjon",
          "userEmail": "botirjon@mail.com" } ], "avgCompletionPerUser": [ {
          "assignedTo": "689d8f559ad355020b526bc5", "avgMs": 86400000, "n": 5 }
          ], "tagsTop": [ { "tag": "work", "count": 15 }, { "tag": "urgent",
          "count": 8 } ], "priorityOverdue": [ { "priority": "high", "overdue":
          1 }, { "priority": "medium", "overdue": 1 } ], "createdPerDay": [ {
          "day": "2025-08-14", "count": 3 }, { "day": "2025-08-15", "count": 2 }
          ], "completedPerDay": [ { "day": "2025-08-14", "count": 1 }, { "day":
          "2025-08-15", "count": 3 } ], "stuckTasks": 1 }
        </div>

        <h3>üë• User Management (Admin Only)</h3>

        <h4>GET /api/users</h4>
        <div class="endpoint">
          <div class="method">GET</div>
          <div class="path">/api/users</div>
          <div class="description">List all users</div>
        </div>

        <h4>GET /api/users/:id</h4>
        <div class="endpoint">
          <div class="method">GET</div>
          <div class="path">/api/users/:id</div>
          <div class="description">Get specific user</div>
        </div>

        <h4>POST /api/users</h4>
        <div class="endpoint">
          <div class="method">POST</div>
          <div class="path">/api/users</div>
          <div class="description">Create new user</div>
        </div>

        <h4>PUT /api/users/:id</h4>
        <div class="endpoint">
          <div class="method">PUT</div>
          <div class="path">/api/users/:id</div>
          <div class="description">Update user</div>
        </div>

        <h4>DELETE /api/users/:id</h4>
        <div class="endpoint">
          <div class="method">DELETE</div>
          <div class="path">/api/users/:id</div>
          <div class="description">Delete user</div>
        </div>
      </div>

      <div class="section">
        <h2>üöÄ Practical Examples</h2>

        <h3>Quick Start with cURL</h3>

        <h4>1. Register a new user</h4>
        <div class="code-block">
          curl -X POST http://localhost:3000/api/auth/register \ -H
          'Content-Type: application/json' \ -d '{ "name": "Botirjon", "email":
          "botirjon@mail.com", "password": "secret123" }'
        </div>

        <h4>2. Login and get token</h4>
        <div class="code-block">
          curl -X POST http://localhost:3000/api/auth/login \ -H 'Content-Type:
          application/json' \ -d '{ "email": "botirjon@mail.com", "password":
          "secret123" }'
        </div>

        <h4>3. Create a task (use token from step 2)</h4>
        <div class="code-block">
          curl -X POST http://localhost:3000/api/tasks \ -H 'Content-Type:
          application/json' \ -H 'Authori zation: YOUR_TOKEN_HERE' \ -d '{
          "title": "Learn API", "description": "Study the task management API",
          "dueDate": "2025-12-31", "priority": "high", "status": "pending",
          "tags": ["learning", "api"] }'
        </div>

        <h4>4. List your tasks</h4>
        <div class="code-block">
          curl -H 'Authorization: YOUR_TOKEN_HERE' \
          'http://localhost:3000/api/tasks?page=1&limit=10'
        </div>

        <h4>5. Update task status (auto-tracks history)</h4>
        <div class="code-block">
          curl -X PUT http://localhost:3000/api/tasks/TASK_ID_HERE \ -H
          'Content-Type: application/json' \ -H 'Authorization: YOUR_TOKEN_HERE'
          \ -d '{"status": "in_progress"}'
        </div>

        <h4>6. Get analytics (admin only)</h4>
        <div class="code-block">
          curl -H 'Authorization: ADMIN_TOKEN_HERE' \
          'http://localhost:3000/api/tasks/analytics?from=2025-01-01&to=2025-12-31'
        </div>

        <h3>JavaScript/Fetch Examples</h3>

        <h4>Login and create task</h4>
        <div class="code-block">
          // Login const loginResponse = await
          fetch('http://localhost:3000/api/auth/login', { method: 'POST',
          headers: { 'Content-Type': 'application/json' }, body:
          JSON.stringify({ email: 'john@example.com', password: 'secret123' })
          }); const { accessToken } = await loginResponse.json(); // Create task
          const taskResponse = await fetch('http://localhost:3000/api/tasks', {
          method: 'POST', headers: { 'Content-Type': 'application/json',
          'Authorization': ` ${accessToken}` }, body: JSON.stringify({ title:
          'New Task', description: 'Task description', dueDate: '2025-12-31',
          priority: 'medium', status: 'pending' }) }); const task = await
          taskResponse.json();
        </div>
      </div>

      <div class="section">
        <h2>üí° Key Features</h2>
        <ul style="margin-left: 20px; line-height: 2">
          <li>
            <strong>Role-Based Access Control:</strong> Admin and User roles
            with different permissions
          </li>
          <li>
            <strong>Task Lifecycle:</strong> Status transitions with automatic
            timestamp tracking
          </li>
          <li>
            <strong>Assignment Workflow:</strong> Tasks can be assigned to users
            with audit trail
          </li>
          <li>
            <strong>History Tracking:</strong> Automatic logging of status
            changes
          </li>
          <li>
            <strong>Analytics:</strong> Comprehensive task statistics for admins
          </li>
          <li>
            <strong>Pagination & Sorting:</strong> Efficient data retrieval with
            query parameters
          </li>
          <li>
            <strong>Validation:</strong> Zod schema validation for all inputs
          </li>
          <li><strong>Logging:</strong> Structured logging with Pino</li>
        </ul>
      </div>

      <div class="section">
        <h2>üîß Development</h2>
        <h3>Project Structure</h3>
        <div class="code-block">
          src/ ‚îú‚îÄ‚îÄ app.ts # Express app setup ‚îú‚îÄ‚îÄ index.ts # Server bootstrap
          ‚îú‚îÄ‚îÄ config/env.ts # Environment config ‚îú‚îÄ‚îÄ lib/ # Utilities (db,
          logger, swagger) ‚îú‚îÄ‚îÄ middlewares/ # Auth, error handling ‚îú‚îÄ‚îÄ routes/ #
          Route mounting ‚îî‚îÄ‚îÄ modules/ # Feature modules ‚îú‚îÄ‚îÄ auth/ #
          Authentication ‚îú‚îÄ‚îÄ users/ # User management ‚îî‚îÄ‚îÄ tasks/ # Task
          management
        </div>

        <h3>Useful Commands</h3>
        <div class="code-block">
          npm run dev # Development with hot reload npm run build # Build for
          production npm start # Run production build npm run clean # Clean
          build artifacts
        </div>
      </div>

      <div class="section">
        <h2>üìä API Status</h2>
        <p>Current status: <span class="status online">üü¢ Online</span></p>
        <p>Base URL: <code>http://localhost:3000/api</code></p>
        <p>Swagger Docs: <code>http://localhost:3000/docs</code></p>
      </div>
    </div>

    <script>
      // Add copy functionality to code blocks
      document.querySelectorAll(".code-block").forEach((block) => {
        const copyBtn = document.createElement("button");
        copyBtn.textContent = "Copy";
        copyBtn.className = "copy-btn";
        copyBtn.onclick = () => {
          navigator.clipboard.writeText(block.textContent.trim());
          copyBtn.textContent = "Copied!";
          copyBtn.classList.add("copied");
          setTimeout(() => {
            copyBtn.textContent = "Copy";
            copyBtn.classList.remove("copied");
          }, 2000);
        };
        block.appendChild(copyBtn);
      });

      // Check API status
      async function checkStatus() {
        try {
          const response = await fetch("/api/tasks");
          const statusElement = document.querySelector(".status");
          if (response.ok) {
            statusElement.textContent = "üü¢ Online";
            statusElement.className = "status online";
          } else {
            statusElement.textContent = "üü° Limited";
            statusElement.className = "status online";
          }
        } catch (error) {
          const statusElement = document.querySelector(".status");
          statusElement.textContent = "üî¥ Offline";
          statusElement.className = "status offline";
        }
      }

      // Check status on load and every 30 seconds
      checkStatus();
      setInterval(checkStatus, 30000);
    </script>
  </body>
</html>
